<!DOCTYPE html>
<html>
<head>
	<title>Ubuntu upload activity</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.flot.min.js"></script>
</head>

<body>
	<h1 id="top">Ubuntu upload activity</h1>
	<div id="activity" style="width:1600px;height:600px;"></div>
	<h1 id="top">Ubuntu upload affiliations</h1>
	<div id="affiliation" style="width:1600px;height:600px;"></div>
	<p><a href="https://code.launchpad.net/~stefanor/+junk/ubuntu-activity">lp:~stefanor/+junk/ubuntu-activity</a></p>
	<p>Generated from <a href="http://udd.debian.org/">UDD</a></p>
	<script type="text/javascript">
	$(function (){
		function plot(element, data, options, releases) {
			var markings = [];
			$.each(releases, function(i, release) {
				if (release['opened'] !== null)
					markings.push({
						color: '#000',
						lideWidth: 1,
						xaxis: {
							from: release['opened'],
							to: release['opened']
						}
					});
				if (release['freeze'] !== null)
					markings.push({
						color: '#f00',
						lideWidth: 0,
						xaxis: {
							from: release['freeze'],
							to: release['freeze']
						}
					});
			});
			if (!('grid' in options))
				options.grid = {};
			if (!('markings' in options.grid))
				options.grid.markings = markings;

			var p = $.plot(element, data, options);

			var height = p.getYAxes()[0].max;
			$.each(releases, function(i, release) {
				if (release['opened'] !== null) {
					o = p.pointOffset({x: release['opened'], y: height});
					element.append('<div style="position: absolute; left: ' + (o.left + 4)
							 + 'px; top: ' + o.top + 'px;">' + release['name'] + '</div>');
				}
			});
		}
		$.getJSON('data.json', function(json) {
			var options = {
				series: {
					lines: {show: true, fill: true},
					points: {show: false},
				},
				xaxis: {
					mode: "time",
				},
				legend: {
					position: "nw",
				},
			};
			var data = [];
			$.each(['main', 'universe', 'multiverse', 'restricted'], function(i, component) {
				data.push({label: component, data: json[component]});
			});
			var e = $("#activity");
			plot(e, data, options, json['releases']);

			data = [];
			$.each(['canonical', 'community'], function(i, affl) {
				data.push({label: affl, data: json[affl]});
			});
			data[0].color = '#772953';
			data[1].color = '#dbba75';
			e = $("#affiliation");
			plot(e, data, options, json['releases']);
		});
	});
	</script>
</body>
</html>
